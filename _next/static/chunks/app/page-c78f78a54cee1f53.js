(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1188:function(e,t,a){Promise.resolve().then(a.bind(a,2336))},2336:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return U}});var r,n,s,i,o,l,u,c,d=a(3827),m=a(828);(r=o||(o={}))[r["未開啟"]=0]="未開啟",r[r["安全開啟"]=1]="安全開啟",r[r["標記旗子"]=2]="標記旗子",r[r["死亡"]=3]="死亡",r[r["錯標旗子"]=4]="錯標旗子",r[r["未標炸彈"]=5]="未標炸彈",(n=l||(l={}))[n["左鍵"]=0]="左鍵",n[n["右鍵"]=2]="右鍵",(s=u||(u={}))[s["初始化"]=0]="初始化",s[s["進行中"]=1]="進行中",s[s["暫停"]=2]="暫停",s[s["失敗"]=3]="失敗",s[s["勝利"]=4]="勝利";var g=a(4090);let x=e=>{let[t,a]=(0,g.useState)(0);return(0,g.useEffect)(()=>{let t;return e===u["進行中"]?t=setInterval(()=>{a(e=>e+1)},1e3):e===u["初始化"]&&a(0),()=>clearInterval(t)},[e]),{time:t}};function f(e,t){return Array.from(Array(e)).map(()=>Array.from(Array(t)).map(()=>({status:o["未開啟"],isMines:!1,value:-1})))}function p(e){e.forEach(e=>e.forEach(e=>{e.status===o["未開啟"]&&e.isMines?e.status=o["未標炸彈"]:e.status!==o["標記旗子"]||e.isMines||(e.status=o["錯標旗子"])}))}function h(e,t){console.log("openSquare!");let{row:a,col:r}=t,n=e[a][r];if(n.status===o["未開啟"]){if(n.isMines&&n.status===o["未開啟"]){n.status=o["死亡"],p(e);return}if(n.status=o["安全開啟"],0===n.value)for(let t=-1;t<2;t++){let n=a+t;for(let t=-1;t<2;t++){let a=r+t;if(e[n]&&e[n][a]){let t=e[n][a];t.status===o["未開啟"]&&!1===t.isMines&&(0===t.value?h(e,{row:n,col:a}):t.status=o["安全開啟"])}}}}}function b(e){let t=e.board.flat();return t.find(e=>e.status===o["死亡"])?u["失敗"]:t.filter(e=>[o["未開啟"],o["標記旗子"]].includes(e.status)).length===e.setting.minesNumber?u["勝利"]:u["進行中"]}var j=a(8166);let y={rowSize:1,colSize:4,minesNumber:1,initIndex:{row:0,col:0}},v={gameData:{setting:y,board:f(y.rowSize,y.colSize)},gameStatus:u["初始化"]},S=(0,j.oM)({name:"game",initialState:v,reducers:{startGame:(e,t)=>{let a=t.payload,{minesNumber:r,rowSize:n,colSize:s}=e.gameData.setting;if(r<n*s&&r>0&&n*s>0){let t={...e.gameData.setting,initIndex:a};e.gameData={board:function(e){let t=new Set;for(;t.size<e.minesNumber;){let a=Math.floor(Math.random()*e.rowSize),r=Math.floor(Math.random()*e.colSize);(a!==e.initIndex.row||r!==e.initIndex.col)&&t.add("".concat(a,",").concat(r))}let a=f(e.rowSize,e.colSize);return Array.from(t).forEach(e=>{let[t,r]=e.split(",").map(e=>parseInt(e));a[t][r].isMines=!0}),a.map((e,t)=>e.map((e,r)=>{if(e.isMines)return e;let n=function(e,t){let a=0;for(let n=-1;n<2;n++){let s=t.row+n;for(let n=-1;n<2;n++){var r;let i=t.col+n;e[s]&&(null===(r=e[s][i])||void 0===r?void 0:r.isMines)&&a++}}return a}(a,{row:t,col:r});return{...e,value:n}}))}(t),setting:t},h(e.gameData.board,a),e.gameStatus=b(e.gameData)}},giveUp:e=>{e.gameData&&(p(e.gameData.board),e.gameStatus=u["失敗"])},resetGame:e=>{let{rowSize:t,colSize:a}=e.gameData.setting;e.gameData={...e.gameData,board:f(t,a)},e.gameStatus=u["初始化"]},pauseTime:e=>{e.gameStatus=u["暫停"]},continueTime:e=>{e.gameStatus=u["進行中"]},openSquare:(e,t)=>{e.gameData&&(h(e.gameData.board,t.payload),e.gameStatus=b(e.gameData))},setMark:(e,t)=>{e.gameData&&function(e,t){let{row:a,col:r}=t,n=e[a][r];n.status===o["未開啟"]?n.status=o["標記旗子"]:n.status===o["標記旗子"]&&(n.status=o["未開啟"])}(e.gameData.board,t.payload)},settingEmpty:(e,t)=>{let{rowSize:a,colSize:r}=t.payload;e.gameData={setting:t.payload,board:f(a,r)}}}}),w=S.actions;var C=S.reducer;let k=(0,a(3646).UY)({game:C}),D=(0,j.xC)({reducer:k}),z=m.v9;var M=a(7535),I=a(8024);function E(e){return(0,d.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid, white",borderRadius:"3px",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",marginRight:"10px",marginLeft:"10px",flexDirection:"column"},children:[(0,d.jsx)("span",{style:{fontSize:15,wordBreak:"keep-all"},children:e.name}),(0,d.jsx)("span",{children:e.value})]})}(i=c||(c={}))[i["笑臉"]=0]="笑臉",i[i["平常"]=1]="平常",i[i["死亡"]=2]="死亡",i[i["勝利"]=3]="勝利";var N=function(e){let[t,a]=(0,g.useState)(1),r=(0,g.useRef)(0),n=(0,g.useRef)(),s=(0,g.useMemo)(()=>e.game.setting.minesNumber-e.game.board.flat().filter(e=>e.status===o["標記旗子"]).length,[e.game]);(0,g.useEffect)(()=>{switch(e.gameState){case u["失敗"]:a(2);break;case u["勝利"]:a(3);break;case u["進行中"]:{let t=e.game.board.flat().filter(e=>e.status===o["安全開啟"]).length;t>r.current&&(a(0),r.current=t);break}case u["初始化"]:r.current=0,a(1)}},[e.game.board,e.gameState]),(0,g.useEffect)(()=>{0===t?(n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{a(1)},300)):(2===t||3===t)&&n.current&&clearTimeout(n.current)},[t]);let i=(0,g.useMemo)(()=>{switch(t){case 2:return M.bmm;case 3:return M.c5N;case 0:return M.Lew;case 1:return M.FRD}},[t]);return(0,d.jsxs)("div",{style:{maxWidth:"100%"},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",width:"100%",padding:5,fontSize:"24px"},children:[(0,d.jsx)(E,{name:"剩餘標記",value:s}),(0,d.jsx)(I.G,{icon:i,style:{color:"white"}}),(0,d.jsx)(E,{name:"計時",value:e.time})]}),(0,d.jsx)("hr",{style:{marginTop:5,marginBottom:10,borderColor:"darkblue"}})]})},R=a(6550);function Z(e){let[t,a]=(0,g.useState)(!1),r=void 0===e.children?(0,d.jsx)(d.Fragment,{}):e.children;return(0,d.jsx)(R.Z,{style:{border:"1px solid black",fontFamily:"monospace",userSelect:"none",cursor:"pointer",color:"white",backgroundColor:"#155c9e",display:"flex",width:"35px",height:"35px",alignItems:"center",justifyContent:"center",borderRadius:4,margin:.5,borderColor:"#8e9ba9",aspectRatio:1,filter:t?"brightness(0.92)":void 0,...e.style},onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),onMouseUp:a=>{t&&(a.button===l["左鍵"]?e.onClick(l["左鍵"]):e.onClick(l["右鍵"]))},onContextMenu:e=>e.preventDefault(),children:r})}var G=function(e){console.log("Square render");let t={color:1===e.data.value?"white":2===e.data.value?"#65d60d":"#ff82e1",backgroundColor:"#155c9e",borderColor:"#465565",boxShadow:"rgb(0 0 0 / 10%) 1px -2px 1px 0px inset"},a={backgroundColor:"#feeaf2",fontSize:"15px",color:"red",boxShadow:"rgba(255, 8, 8, 0.29) 0px -1px 3px 1px inset"},r={...a,color:"black"},n={...a,backgroundColor:"#ff8c8cf5"};switch(e.data.status){case o["未開啟"]:return(0,d.jsx)(Z,{...e,style:{backgroundColor:"#e2ecf7",borderColor:"#8e9ba9",boxShadow:"rgb(126 182 247 / 29%) 1px -3px 3px 0px inset"}});case o["標記旗子"]:return(0,d.jsx)(Z,{...e,style:a,children:(0,d.jsx)(I.G,{icon:M.RrC})});case o["死亡"]:return(0,d.jsx)(Z,{...e,style:r,children:(0,d.jsx)(I.G,{icon:M.bE7})});case o["安全開啟"]:return(0,d.jsx)(Z,{...e,style:t,children:e.data.value>0?(0,d.jsx)("span",{children:e.data.value}):(0,d.jsx)(d.Fragment,{})});case o["未標炸彈"]:return(0,d.jsx)(Z,{...e,style:r,children:(0,d.jsx)(I.G,{icon:M.Yme})});case o["錯標旗子"]:return(0,d.jsx)(Z,{...e,style:n,children:(0,d.jsx)(I.G,{icon:M.RrC})});default:throw Error("方格狀態未實作: ".concat(e.data.status))}};let T=g.memo(function(e){return(0,d.jsx)("div",{style:{flexWrap:"nowrap",display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 125px)",maxWidth:"auto",overflow:"auto",padding:5},children:e.board.map((t,a)=>(0,d.jsx)("div",{style:{display:"flex",flex:"1"},children:t.map((t,r)=>(0,d.jsx)(G,{data:t,onClick:t=>e.onClick({row:a,col:r},t)},"".concat(a,", ").concat(r)))},a))})});function B(e){return(0,d.jsxs)("div",{style:{border:"10px solid #1d71c8",borderRadius:10,backgroundColor:"#1d71c8",maxWidth:"inherit"},children:[(0,d.jsx)(N,{game:e.gameData,gameState:e.gameStatus,time:e.time}),(0,d.jsx)(T,{board:e.gameData.board,onClick:e.onClick})]})}var _=a(6069),A=a(5914),L=a(590),O=function(e){let[t,a]=(0,g.useState)(e.value.toString());return(0,g.useEffect)(()=>{a(e.value.toString())},[e.value]),(0,d.jsxs)(_.Z.Group,{as:A.Z,controlId:"rowSize",style:{display:"flex",alignItems:"center",marginBottom:"5px"},children:[(0,d.jsx)(_.Z.Label,{column:!0,xs:3,sm:3,md:6,lg:4,children:e.name}),(0,d.jsx)(L.Z,{xs:9,sm:9,md:6,lg:8,children:(0,d.jsx)(_.Z.Control,{disabled:e.disabled,size:"sm",value:t,onChange:t=>{if(""===t.target.value)a(t.target.value);else{let a=parseInt(t.target.value);void 0!==e.max&&(a=Math.min(e.max,a)),e.setValue(a)}},onBlur:()=>a(e.value.toString()),placeholder:e.name,type:"number",autoComplete:"off"})})]})},q=function(){return(0,d.jsx)("div",{style:{display:"flex",borderTopLeftRadius:10,borderTopRightRadius:10,border:"3px solid #1d71c8",padding:20,backgroundColor:"#1d71c8",justifyContent:"center",color:"white",width:"100%"},children:(0,d.jsx)("span",{style:{display:"flex",justifyContent:"center",alignItems:"center",letterSpacing:"5px"},children:"踩地雷資訊"})})};function F(){let e=z(e=>e.game.gameData),t=z(e=>e.game.gameStatus),a=(0,m.I0)();function r(t,r){if(!isNaN(t)&&t>0){let n={...e.setting};n[r]=t,n.minesNumber=Math.min(n.minesNumber,n.rowSize*n.colSize-1),a(w.settingEmpty(n))}}let n=t!==u["初始化"];return(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,d.jsx)(q,{}),(0,d.jsxs)("div",{style:{backgroundColor:"lightblue",padding:20,display:"flex",flexDirection:"column",height:"100%"},children:[(0,d.jsx)("div",{style:{display:"flex",justifyContent:"center",backgroundColor:"white",border:"1px solid white",borderRadius:3,padding:10,marginBottom:10,color:"#4b4b4b"},children:(0,d.jsxs)("span",{children:["狀態：",function(e,t){let a=Object.values(e).indexOf(t);return Object.keys(e)[a]}(u,t)]})}),(0,d.jsx)(O,{disabled:n,value:e.setting.rowSize,name:"直排數",setValue:e=>r(e,"rowSize"),max:50}),(0,d.jsx)(O,{disabled:n,value:e.setting.colSize,name:"橫排數",setValue:e=>r(e,"colSize"),max:50}),(0,d.jsx)(O,{disabled:n,value:e.setting.minesNumber,name:"地雷數",setValue:e=>r(e,"minesNumber"),max:e.setting.rowSize*e.setting.colSize}),t!==u["初始化"]&&(0,d.jsx)(R.Z,{style:{marginTop:15},onClick:()=>a(w.resetGame()),children:"重新挑戰"})]})]})}var V=a(7753);function W(){let e=z(e=>e.game.gameData),t=z(e=>e.game.gameStatus),a=(0,m.I0)(),{time:r}=x(t),n=(0,g.useCallback)((e,r)=>{t===u["初始化"]?a(w.startGame(e)):t===u["進行中"]&&(r===l["左鍵"]?a(w.openSquare(e)):a(w.setMark(e)))},[a,t]);return(0,d.jsx)(V.Z,{style:{marginTop:20,marginBottom:20},children:(0,d.jsxs)(A.Z,{children:[(0,d.jsx)(L.Z,{sm:12,md:8,style:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,d.jsx)(B,{gameData:e,gameStatus:t,time:r,onClick:n})}),(0,d.jsx)(L.Z,{sm:12,md:4,style:{height:"calc(100vh - 40px)"},children:(0,d.jsx)(F,{})})]})})}function U(){return(0,d.jsx)(m.zt,{store:D,children:(0,d.jsx)(W,{})})}}},function(e){e.O(0,[676,606,971,69,744],function(){return e(e.s=1188)}),_N_E=e.O()}]);